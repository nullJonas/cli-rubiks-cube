#include "turns.h"

/*
This list contains the matrices for all possible one-layer moves.
*/
static int Turn_Matrices[18][5][4][3] = {
    {   // R matrix
    {{2,0,2},{0,0,2},{4,2,0},{5,0,2}},
    {{2,1,2},{0,1,2},{4,1,0},{5,1,2}},
    {{2,2,2},{0,2,2},{4,0,0},{5,2,2}},
    {{3,0,0},{3,0,2},{3,2,2},{3,2,0}},
    {{3,1,0},{3,0,1},{3,1,2},{3,2,1}},
    },
    {   // U matrix
    {{2,0,0},{1,0,0},{4,0,0},{3,0,0}},
    {{2,0,1},{1,0,1},{4,0,1},{3,0,1}},
    {{2,0,2},{1,0,2},{4,0,2},{3,0,2}},
    {{0,0,0},{0,0,2},{0,2,2},{0,2,0}},
    {{0,1,0},{0,0,1},{0,1,2},{0,2,1}},
    },
    {   // F matrix
    {{1,0,2},{0,2,2},{3,2,0},{5,0,0}},
    {{1,1,2},{0,2,1},{3,1,0},{5,0,1}},
    {{1,2,2},{0,2,0},{3,0,0},{5,0,2}},
    {{2,0,0},{2,0,2},{2,2,2},{2,2,0}},
    {{2,1,0},{2,0,1},{2,1,2},{2,2,1}},
    },
    {   // L matrix
    {{2,0,0},{5,0,0},{4,2,2},{0,0,0}},
    {{2,1,0},{5,1,0},{4,1,2},{0,1,0}},
    {{2,2,0},{5,2,0},{4,0,2},{0,2,0}},
    {{1,0,0},{1,0,2},{1,2,2},{1,2,0}},
    {{1,1,0},{1,0,1},{1,1,2},{1,2,1}},
    },
    {   // D matrix
    {{3,2,0},{4,2,0},{1,2,0},{2,2,0}},
    {{3,2,1},{4,2,1},{1,2,1},{2,2,1}},
    {{3,2,2},{4,2,2},{1,2,2},{2,2,2}},
    {{5,0,0},{5,0,2},{5,2,2},{5,2,0}},
    {{5,1,0},{5,0,1},{5,1,2},{5,2,1}},
    },
    {   // B matrix
    {{0,0,0},{1,2,0},{5,2,2},{3,0,2}},
    {{0,0,1},{1,1,0},{5,2,1},{3,1,2}},
    {{0,0,2},{1,0,0},{5,2,0},{3,2,2}},
    {{4,0,0},{4,0,2},{4,2,2},{4,2,0}},
    {{4,1,0},{4,0,1},{4,1,2},{4,2,1}},
    },
    {   // M matrix
    {{0,0,1},{2,0,1},{5,0,1},{4,2,1}},
    {{0,1,1},{2,1,1},{5,1,1},{4,1,1}},
    {{0,2,1},{2,2,1},{5,2,1},{4,0,1}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    },
    {   // E matrix
    {{2,1,0},{3,1,0},{4,1,0},{1,1,0}},
    {{2,1,1},{3,1,1},{4,1,1},{1,1,1}},
    {{2,1,2},{3,1,2},{4,1,2},{1,1,2}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    },
    {   // S matrix
    {{0,1,0},{3,0,1},{5,1,2},{1,2,1}},
    {{0,1,1},{3,1,1},{5,1,1},{1,1,1}},
    {{0,1,2},{3,2,1},{5,1,0},{1,0,1}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    },
    {   // Ri matrix
    {{5,0,2},{4,2,0},{0,0,2},{2,0,2}},
    {{5,1,2},{4,1,0},{0,1,2},{2,1,2}},
    {{5,2,2},{4,0,0},{0,2,2},{2,2,2}},
    {{3,2,0},{3,2,2},{3,0,2},{3,0,0}},
    {{3,2,1},{3,1,2},{3,0,1},{3,1,0}},
    },
    {   // Ui matrix
    {{3,0,0},{4,0,0},{1,0,0},{2,0,0}},
    {{3,0,1},{4,0,1},{1,0,1},{2,0,1}},
    {{3,0,2},{4,0,2},{1,0,2},{2,0,2}},
    {{0,2,0},{0,2,2},{0,0,2},{0,0,0}},
    {{0,2,1},{0,1,2},{0,0,1},{0,1,0}},
    },
    {   // Fi matrix
    {{5,0,0},{3,2,0},{0,2,2},{1,0,2}},
    {{5,0,1},{3,1,0},{0,2,1},{1,1,2}},
    {{5,0,2},{3,0,0},{0,2,0},{1,2,2}},
    {{2,2,0},{2,2,2},{2,0,2},{2,0,0}},
    {{2,2,1},{2,1,2},{2,0,1},{2,1,0}},
    },
    {   // Li matrix
    {{0,0,0},{4,2,2},{5,0,0},{2,0,0}},
    {{0,1,0},{4,1,2},{5,1,0},{2,1,0}},
    {{0,2,0},{4,0,2},{5,2,0},{2,2,0}},
    {{1,2,0},{1,2,2},{1,0,2},{1,0,0}},
    {{1,2,1},{1,1,2},{1,0,1},{1,1,0}},
    },
    {   // Di matrix
    {{2,2,0},{1,2,0},{4,2,0},{3,2,0}},
    {{2,2,1},{1,2,1},{4,2,1},{3,2,1}},
    {{2,2,2},{1,2,2},{4,2,2},{3,2,2}},
    {{5,2,0},{5,2,2},{5,0,2},{5,0,0}},
    {{5,2,1},{5,1,2},{5,0,1},{5,1,0}},
    },
    {   // Bi matrix
    {{3,0,2},{5,2,2},{1,2,0},{0,0,0}},
    {{3,1,2},{5,2,1},{1,1,0},{0,0,1}},
    {{3,2,2},{5,2,0},{1,0,0},{0,0,2}},
    {{4,2,0},{4,2,2},{4,0,2},{4,0,0}},
    {{4,2,1},{4,1,2},{4,0,1},{4,1,0}},
    },
    {   // Mi matrix
    {{4,2,1},{5,0,1},{2,0,1},{0,0,1}},
    {{4,1,1},{5,1,1},{2,1,1},{0,1,1}},
    {{4,0,1},{5,2,1},{2,2,1},{0,2,1}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    },
    {   // Ei matrix
    {{1,1,0},{4,1,0},{3,1,0},{2,1,0}},
    {{1,1,1},{4,1,1},{3,1,1},{2,1,1}},
    {{1,1,2},{4,1,2},{3,1,2},{2,1,2}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    },
    {   // Si matrix
    {{1,2,1},{5,1,2},{3,0,1},{0,1,0}},
    {{1,1,1},{5,1,1},{3,1,1},{0,1,1}},
    {{1,0,1},{5,1,0},{3,2,1},{0,1,2}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    {{0,0,0},{0,0,0},{0,0,0},{0,0,0}},
    }
};

/*
Rotate the colors stored between 4 stickers.
The stickers' positions are given by the matrix representing that move.
*/
static void rotate(char matrix[6][3][3], int p[4][3]){
    int i;
    char temp = matrix[p[3][0]][p[3][1]][p[3][2]];
    for (i = 3; i > 0; i--)
        matrix[p[i][0]][p[i][1]][p[i][2]] = matrix[p[i-1][0]][p[i-1][1]][p[i-1][2]];
    matrix[p[0][0]][p[0][1]][p[0][2]] = temp;
}

/*
Apply a turn to the current state of the cube.
The turn is specified by it's code.
*/
void turn(struct cube *cube, int code){
    for (int i = 0; i < 5; i++)
        rotate(cube->stickers, Turn_Matrices[code][i]);
}